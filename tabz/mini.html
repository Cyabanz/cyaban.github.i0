<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Play Game</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #181c24; color: #e8eaf0; margin: 0; }
    .game-header { display: flex; align-items: flex-start; gap: 2.5em; padding: 2em 4vw 1.3em 4vw; max-width: 1100px; margin: 0 auto; }
    .game-thumb { width: 84px; height: 84px; border-radius: 18px; object-fit: cover; border: 3px solid #232946; background: #151922; }
    .game-meta-col { flex: 1; display: flex; flex-direction: column; gap: 0.4em; }
    .game-title { font-size: 2.2em; font-weight: 700; color: #90caf9; margin-bottom: 0.15em; }
    .overall-star-rating {
      display: flex;
      align-items: center;
      font-size: 2em;
      margin-bottom: 0.2em;
    }
    .overall-stars .star {
      font-size: 2em;
      color: #ffd600;
      margin-right: 0.1em;
    }
    .overall-rating-text {
      margin-left: 0.5em;
      color: #ffd600;
      font-weight: 700;
      font-size: 0.8em;
    }
    .game-categories { margin-top: 0.1em; margin-bottom: 0.2em; }
    .game-chip { display: inline-block; background: #232946; color: #90caf9; border: 1px solid #90caf9; border-radius: 7px; padding: 0 11px; font-size: 0.97em; margin-right: 0.5em; margin-bottom: 0.2em; }
    .game-plays { font-size: 1.1em; color: #f3e079; background: #252b43; padding: 0.25em 1.1em 0.25em 0.7em; border-radius: 7px; display: inline-flex; align-items: center; gap: 0.4em; margin: 0.65em 0 0.25em 0; font-weight: 600; box-shadow: 0 1px 8px #19193a18; letter-spacing: 0.01em; }
    .game-plays i { color: #ffd600; font-size: 1.13em; margin-right: 0.1em; }
    .game-rating-row { display: flex; align-items: center; gap: 1.1em; min-height: 2.7em; }
    .game-rating-stars { display: inline-flex; align-items: center; gap: 0.16em; font-size: 2.1em; cursor: pointer; user-select: none; }
    .star { color: #ffd600; opacity: 0.58; transition: opacity 0.13s, color 0.12s; }
    .star.filled { opacity: 1; color: #ffd600; }
    .star.hovered { color: #fff176; opacity: 1; }
    .star.disabled { cursor: not-allowed; opacity: 0.38; }
    .game-rating-summary { color: #ffd600; font-size: 1.08em; font-weight: 600; margin-left: 0.6em; }
    .game-rating-yours { color: #90caf9; font-size: 1.02em; margin-left: 1.1em; }
    .game-rating-count { color: #b0b7c3; font-size: 0.99em; margin-left: 0.4em; font-weight: 500; }
    .game-rating-error { color: #e53935; font-size: 0.99em; margin-left: 0.8em; font-weight: 600; }
    .likes-row, .game-actions { margin-top: 1em; }
    .comment-section { max-width: 900px; margin: 2.5em auto 3em auto; background: #232946; border-radius: 16px; padding: 2em 1em 2.5em 1em; }
    .comment-form { display: flex; flex-direction: column; gap: 0.7em; margin-bottom: 2em; }
    .comments-list { display: flex; flex-direction: column; gap: 1.6em; margin-top: 0.7em; }
    .game-iframe-wrap { width: 100vw; max-width: 1090px; margin: 1.1em auto 0 auto; display: flex; justify-content: center; }
    .game-iframe { width: 100%; min-height: 64vw; max-height: 650px; max-width: 900px; border: 0; border-radius: 16px; background: #111; }
    .comment-stars-selector {
      margin-bottom: 0.5em;
      color: #ffd600;
      font-size: 1.1em;
      display: flex;
      align-items: center;
      gap: 0.3em;
    }
    .comment-stars-selector .star {
      font-size: 1.3em;
      color: #ffd600;
      cursor: pointer;
      transition: color 0.1s;
    }
    .comment-stars-selector .star.filled {
      color: #ffd600;
    }
    .comment-stars-display .star {
      font-size: 1.15em;
      color: #ffd600;
      margin-right: 0.02em;
    }
    .comment-avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      margin-right: 1em;
      background: #232946;
      object-fit: cover;
      border: 1px solid #252b43;
    }
    .comment-main { display: flex; flex-direction: column; }
    .comment-user { font-weight: 600; color: #90caf9; margin-right: 0.5em; }
    .comment-date { color: #b0b7c3; font-size: 0.94em; }
    .comment-text { margin: 0.25em 0 0.1em 0; }
    .comment-actions { margin-top: 0.2em; }
    .comment-like-btn { background: none; border: none; color: #ffd600; cursor: pointer; }
    .comment-like-btn.liked { color: #fff176; }
    .comment-likes-count { color: #ffd600; margin-left: 0.2em; }
    .comment-deleted { color: #e53935; font-style: italic; }
    .icon-btn, .action-btn, .logout-btn {
      background: #232946; color: #90caf9; border: none; border-radius: 7px; padding: 0.5em 1.2em; font-size: 1em;
      margin-right: 0.4em; cursor: pointer;
    }
    .icon-btn:active, .action-btn:active { background: #151922; }
    .icon-btn.liked, .icon-btn.disliked, .action-btn.favorited { background: #ffd600; color: #232946; }
    .fav-btn.favorited i { color: #ffd600; }
    .user-photo { width: 36px; height: 36px; border-radius: 50%; margin-right: 0.6em; vertical-align: middle; }
    .user-name { color: #f3e079; font-weight: 600; }
    .logout-btn { margin-left: 1em; }
    .back-btn { position: absolute; top: 1.2em; left: 2vw; background: none; color: #90caf9; border: none; font-size: 1.1em; cursor: pointer; }
    @media (max-width: 700px) {
      .game-header { flex-direction: column; gap: 1em; padding: 1em 2vw 1em 2vw; }
      .game-thumb { width: 64px; height: 64px; }
      .game-title { font-size: 1.25em; }
      .overall-star-rating { font-size: 1.2em; }
    }
  </style>
</head>
<body>
  <button class="back-btn"><i class='bx bx-arrow-back'></i> Back to games</button>
  <div class="game-header">
    <img class="game-thumb" src="" alt="Game">
    <div class="game-meta-col">
      <div class="game-title"></div>
      <div class="overall-star-rating">
        <span class="overall-stars"></span>
        <span class="overall-rating-text"></span>
      </div>
      <div class="game-categories"></div>
      <div class="game-plays"><i class='bx bx-user'></i> 0 plays</div>
      <div class="game-rating-row" data-hover="">
        <span class="game-rating-stars"></span>
        <span class="game-rating-summary"></span>
        <span class="game-rating-count"></span>
        <span class="game-rating-yours"></span>
        <span class="game-rating-error"></span>
      </div>
      <div class="likes-row">
        <button class="icon-btn like-btn" title="Like"><i class='bx bxs-like'></i></button>
        <span class="like-count">0</span>
        <button class="icon-btn dislike-btn" title="Dislike"><i class='bx bxs-dislike'></i></button>
        <span class="dislike-count">0</span>
        <button class="action-btn fav-btn" title="Favorite"><i class='bx bxs-star'></i> Favorite</button>
        <button class="action-btn fullscreen-btn" title="Fullscreen"><i class='bx bx-fullscreen'></i> Fullscreen</button>
        <button class="game-controls-btn" title="Controls"><i class='bx bx-info-circle'></i> Controls</button>
      </div>
      <div class="game-controls-info" style="display:none;"></div>
    </div>
  </div>
  <div class="game-desc"></div>
  <div class="game-iframe-wrap"></div>
  <div class="game-actions">
    <button class="action-btn play-btn"><i class='bx bx-play'></i> Play</button>
    <button class="action-btn auth-btn" style="display:none;"><i class='bx bxl-google'></i> Sign in with Google</button>
    <img class="user-photo" style="display:none;">
    <span class="user-name" style="display:none;"></span>
    <button class="logout-btn" style="display:none;">Logout</button>
  </div>
  <main>
    <div class="comment-section">
      <div class="comment-title">Comments</div>
      <form class="comment-form" style="display:none;">
        <div class="comment-stars-selector">
          Rate this game:
          <span class="comment-stars"></span>
        </div>
        <textarea class="comment-input" placeholder="Write a comment..." maxlength="500"></textarea>
        <button class="comment-post-btn" type="submit" disabled>Post</button>
        <div class="comment-error"></div>
      </form>
      <div class="comment-form-info" style="display:none;">Sign in to post a comment.</div>
      <div class="comments-list"></div>
    </div>
  </main>
  <script type="module">
    // --- BEGIN STAR PICKER BULLETPROOF FIX ---
    let commentStarRating = 0;
    window._commentStarRating = 0;
    function renderCommentStarsSelector(hover=0) {
      const starsWrap = document.querySelector('.comment-stars');
      starsWrap.innerHTML = '';
      let fill = hover || commentStarRating;
      for (let i=1; i<=5; i++) {
        const s = document.createElement('span');
        s.className = 'star' + (i <= fill ? ' filled' : '');
        s.innerHTML = 'â˜…';
        s.addEventListener('mouseenter', () => renderCommentStarsSelector(i));
        s.addEventListener('mouseleave', () => renderCommentStarsSelector(0));
        s.addEventListener('click', function(e) {
          commentStarRating = i;
          window._commentStarRating = i;
          // Visual feedback: highlight selection immediately
          renderCommentStarsSelector();
        });
        starsWrap.appendChild(s);
      }
    }
    // Initial render, must be called ONCE at load and after post/reset
    document.addEventListener('DOMContentLoaded', () => {
      renderCommentStarsSelector();
    });
    // --- END STAR PICKER BULLETPROOF FIX ---

    // --- FIREBASE CODE OMITTED FOR BREVITY ---
    // The rest of your code (Firebase setup, rating, comments, etc.) goes here...
    // Just replace your current renderCommentStarsSelector with the above.

    // Example usage for the comment form (replace with your Firebase logic):
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.querySelector('.comment-form');
      if (!form) return;
      form.onsubmit = e => {
        e.preventDefault();
        const text = document.querySelector('.comment-input').value.trim();
        if (!text) return;
        if (commentStarRating === 0) {
          document.querySelector('.comment-error').textContent = "Select a star rating.";
          return;
        }
        document.querySelector('.comment-error').textContent = '';
        alert('Posted comment: ' + text + ' with stars: ' + commentStarRating);
        commentStarRating = 0;
        window._commentStarRating = 0;
        renderCommentStarsSelector();
        document.querySelector('.comment-input').value = '';
      };
      document.querySelector('.comment-input').oninput = () => {
        document.querySelector('.comment-post-btn').disabled = !document.querySelector('.comment-input').value.trim();
        document.querySelector('.comment-error').textContent = '';
      };
    });
    // --- END EXAMPLE USAGE ---
  </script>
</body>
</html>
