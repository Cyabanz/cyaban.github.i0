<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Tab</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      background: var(--nt-bg, #202124);
      color: var(--nt-color, #e8eaed);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      transition: background 0.2s, color 0.2s;
    }
    .search-bar {
      margin-top: 60px;
      width: 100%;
      max-width: 480px;
      display: flex;
      border-radius: 24px;
      overflow: hidden;
      border: 1px solid #444;
      background: #303134;
    }
    .search-bar input {
      flex: 1;
      padding: 16px;
      border: none;
      background: transparent;
      color: inherit;
      font-size: 1.2rem;
      outline: none;
    }
    .search-bar button {
      background: #444;
      color: inherit;
      border: none;
      padding: 0 20px;
      cursor: pointer;
      font-size: 1.2rem;
      outline: none;
    }
    .bookmarks {
      margin-top: 32px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(112px, 1fr));
      gap: 24px;
      width: 100%;
      max-width: 640px;
    }
    .bookmark {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #28292c;
      border-radius: 12px;
      padding: 18px 8px;
      text-decoration: none;
      transition: background 0.2s;
      position: relative;
    }
    .bookmark:hover {
      background: #35363a;
    }
    .bookmark-icon {
      width: 36px;
      height: 36px;
      margin-bottom: 8px;
      border-radius: 8px;
      background: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.7em;
    }
    .bookmark-label {
      text-align: center;
      font-size: 1em;
      color: inherit;
      word-break: break-word;
    }
    .delete-bookmark-btn {
      position: absolute;
      top: 6px;
      right: 8px;
      background: #28292c;
      color: #c00;
      border: none;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1em;
      cursor: pointer;
      opacity: 0.7;
      z-index: 2;
      transition: background 0.2s;
    }
    .bookmark:hover .delete-bookmark-btn {
      opacity: 1;
    }
    #theme-switcher {
      margin-top: 36px;
      display: flex;
      gap: 10px;
    }
    .theme-btn {
      background: #444;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 7px 16px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .theme-btn.active, .theme-btn:hover {
      background: #1a73e8;
      color: #fff;
    }
    .uv-features {
      margin-top: 40px;
      width: 100%;
      max-width: 600px;
      background: #232336;
      border-radius: 14px;
      padding: 18px 22px;
      color: #d8d9fa;
      font-size: 1.07em;
      box-shadow: 0 2px 16px #19193a44;
    }
    .uv-features h3 {
      margin: 0 0 10px 0;
      color: #ffd700;
      font-size: 1.19em;
    }
    .uv-features ul {
      margin: 0 0 0 22px;
      padding: 0;
    }
    .uv-features li {
      margin-bottom: 7px;
      line-height: 1.7;
    }
    .add-bookmark-bar {
      margin-top: 20px;
      width: 100%;
      max-width: 640px;
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: center;
    }
    .add-bookmark-bar input {
      background: #232336;
      border: 1px solid #444;
      color: #eee;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 1em;
      width: 200px;
      outline: none;
    }
    .add-bookmark-bar input[type="text"] { min-width: 120px; }
    .add-bookmark-bar input[type="text"]:focus { border-color: #1a73e8; }
    .add-bookmark-bar button {
      background: #1a73e8;
      color: #fff;
      border: none;
      padding: 7px 15px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 1em;
    }
    .add-bookmark-bar button:hover {
      background: #155ab6;
    }
    @media (max-width: 700px) {
      .bookmarks, .uv-features, .add-bookmark-bar { max-width: 98vw; }
      .search-bar { max-width: 97vw; }
    }
  </style>
  <script src="/uv/uv.bundle.js"></script>
  <script src="/uv/uv.config.js"></script>
</head>
<body>
  <form class="search-bar" id="nt-search-form" autocomplete="off">
    <input id="nt-search" type="text" placeholder="Search or type a URL" autofocus>
    <button type="submit">→</button>
  </form>
  <div class="add-bookmark-bar">
    <input type="text" id="bm-url" placeholder="Bookmark URL (https://)">
    <input type="text" id="bm-label" placeholder="Label (e.g. Twitter)">
    <input type="text" id="bm-icon" placeholder="Emoji/Icon (e.g. 🐦)">
    <button id="bm-add">Add Bookmark</button>
  </div>
  <div class="bookmarks" id="nt-bookmarks"></div>
  <div id="theme-switcher">
    <button class="theme-btn" id="nt-theme-dark">Dark</button>
    <button class="theme-btn" id="nt-theme-light">Light</button>
    <button class="theme-btn" id="nt-theme-custom">Custom</button>
  </div>
  <div class="uv-features">
    <h3>Ultraviolet Features</h3>
    <ul>
      <li>Bypass web filters and browse the web privately.</li>
      <li>Supports most modern websites (YouTube, Google, Discord, etc).</li>
      <li>Customizable search engine and easy tab navigation.</li>
      <li>Theme switching between Dark, Light, and Custom modes.</li>
      <li>Bookmarks/shortcuts for quick access to favorite sites.</li>
      <li>Drag-and-drop tabs, ad skipping, and more!</li>
    </ul>
  </div>
  <script>
    // --- Default bookmarks ---
    const defaultBookmarks = [
      { url: "https://www.google.com", label: "Google", icon: "🔎" },
      { url: "https://www.youtube.com", label: "YouTube", icon: "▶️" },
      { url: "https://github.com", label: "GitHub", icon: "🐙" },
      { url: "https://mail.google.com", label: "Gmail", icon: "✉️" },
      { url: "https://chat.openai.com", label: "ChatGPT", icon: "💬" }
    ];

    const USER_BM_KEY = "uv_user_bookmarks_v1";
    const bmEl = document.getElementById('nt-bookmarks');

    function getUserBookmarks() {
      try {
        const arr = JSON.parse(localStorage.getItem(USER_BM_KEY));
        return Array.isArray(arr) ? arr : [];
      } catch { return []; }
    }
    function setUserBookmarks(arr) {
      localStorage.setItem(USER_BM_KEY, JSON.stringify(arr));
    }
    function allBookmarks() {
      // Merge default and user bookmarks (user bookmarks after default)
      return [...defaultBookmarks, ...getUserBookmarks()];
    }
    function renderBookmarks() {
      bmEl.innerHTML = "";
      const bookmarks = allBookmarks();
      bookmarks.forEach((bm, idx) => {
        const a = document.createElement('a');
        a.className = 'bookmark';
        a.href = "#";
        a.innerHTML = `<div class="bookmark-icon">${bm.icon || "🔗"}</div>
          <div class="bookmark-label">${bm.label || bm.url}</div>`;
        a.addEventListener('click', e => {
          e.preventDefault();
          openUvUrl(bm.url);
        });

        // Allow deleting user bookmarks (but not default)
        if (idx >= defaultBookmarks.length) {
          const btn = document.createElement("button");
          btn.className = "delete-bookmark-btn";
          btn.innerHTML = "✕";
          btn.title = "Delete";
          btn.onclick = (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            const userBms = getUserBookmarks();
            userBms.splice(idx - defaultBookmarks.length, 1);
            setUserBookmarks(userBms);
            renderBookmarks();
          };
          a.appendChild(btn);
        }
        bmEl.appendChild(a);
      });
    }

    // --- Add bookmark handler ---
    document.getElementById("bm-add").onclick = function(e) {
      e.preventDefault();
      const url = document.getElementById("bm-url").value.trim();
      const label = document.getElementById("bm-label").value.trim();
      const icon = document.getElementById("bm-icon").value.trim();
      if (!/^https?:\/\//i.test(url)) {
        alert("Please enter a valid URL (starts with https:// or http://)");
        return;
      }
      if (!label) {
        alert("Please enter a label for your bookmark.");
        return;
      }
      const userBms = getUserBookmarks();
      if (userBms.find(bm => bm.url === url)) {
        alert("Bookmark already exists!");
        return;
      }
      userBms.push({url, label, icon});
      setUserBookmarks(userBms);
      document.getElementById("bm-url").value = "";
      document.getElementById("bm-label").value = "";
      document.getElementById("bm-icon").value = "";
      renderBookmarks();
    };

    // --- UV Search Bar ---
    function proxifyUrl(url) {
      if (url.startsWith(location.origin + __uv$config.prefix)) return url;
      return __uv$config.prefix + __uv$config.encodeUrl(url);
    }
    function openUvUrl(url) {
      if (window.parent !== window) {
        window.parent.postMessage({ ntNavigate: url }, '*');
      } else {
        window.location.href = proxifyUrl(url);
      }
    }
    window.addEventListener('message', e => {
      if (e.data.ntSetTheme) setTheme(e.data.ntSetTheme.dark, e.data.ntSetTheme.custom);
      if (e.data.ntNavigate) openUvUrl(e.data.ntNavigate);
    });

    const searchEngine = localStorage.getItem('searchEngine') || 'https://www.google.com/search?q=';
    document.getElementById('nt-search-form').addEventListener('submit', e => {
      e.preventDefault();
      let q = document.getElementById('nt-search').value.trim();
      if (!q) return;
      if (!q.includes('://')) {
        if (q.includes('.')) q = 'https://' + q;
        else q = searchEngine + encodeURIComponent(q);
      }
      openUvUrl(q);
    });

    // --- Theme Switcher ---
    function setTheme(dark, custom) {
      if (custom) {
        document.body.style.setProperty('--nt-bg', custom.bg || '#202124');
        document.body.style.setProperty('--nt-color', custom.color || '#e8eaed');
      } else if (dark) {
        document.body.style.setProperty('--nt-bg', '#202124');
        document.body.style.setProperty('--nt-color', '#e8eaed');
      } else {
        document.body.style.setProperty('--nt-bg', '#f8f9fa');
        document.body.style.setProperty('--nt-color', '#1a1a1a');
      }
    }
    function applyThemeBtn(which) {
      document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
      if (which === 'dark') document.getElementById('nt-theme-dark').classList.add('active');
      if (which === 'light') document.getElementById('nt-theme-light').classList.add('active');
      if (which === 'custom') document.getElementById('nt-theme-custom').classList.add('active');
    }
    document.getElementById('nt-theme-dark').onclick = () => {
      parent.postMessage({ ntThemeSelected: 'dark' }, '*');
      setTheme(true);
      applyThemeBtn('dark');
    };
    document.getElementById('nt-theme-light').onclick = () => {
      parent.postMessage({ ntThemeSelected: 'light' }, '*');
      setTheme(false);
      applyThemeBtn('light');
    };
    document.getElementById('nt-theme-custom').onclick = () => {
      parent.postMessage({ ntThemeSelected: 'custom' }, '*');
      setTheme(false, { bg: '#2e2f50', color: '#ffd700' });
      applyThemeBtn('custom');
    };
    setTheme(true); // Default dark
    applyThemeBtn('dark');

    // --- Init ---
    renderBookmarks();
  </script>
</body>
</html>
