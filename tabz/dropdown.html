<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fusion Tabs - Settings</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background: var(--bg, #0f0f0f);
      color: var(--fg, #ffffff);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      transition: background 0.3s ease, color 0.3s ease;
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(120, 198, 255, 0.08) 0%, transparent 50%);
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 24px;
    }
    h1 {
      text-align: center;
      margin-bottom: 48px;
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--fg, #ffffff) 0%, rgba(255,255,255,0.7) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .settings-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      align-items: stretch;
    }
    .section {
      background: var(--section-bg, rgba(255, 255, 255, 0.05));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 32px;
      border-radius: 20px;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.05) inset;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    }
    .section:hover {
      transform: translateY(-4px);
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(255, 255, 255, 0.1) inset;
    }
    .section-title {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--fg, #ffffff);
    }
    .section-desc {
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 24px;
      line-height: 1.5;
    }
    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }
    .setting-row:last-child { margin-bottom: 0; }
    .toggle-switch {
      position: relative;
      width: 54px;
      height: 30px;
      display: inline-block;
      flex-shrink: 0;
    }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      border-radius: 30px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 26px; width: 26px;
      left: 2px; bottom: 1px;
      background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
      transition: all 0.3s ease;
      border-radius: 50%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    input:checked + .slider {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: rgba(255, 255, 255, 0.3);
    }
    input:checked + .slider:before {
      transform: translateX(24px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }
    .theme-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 24px;
    }
    .theme-btn {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      background: rgba(255, 255, 255, 0.05);
      color: var(--fg, #ffffff);
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.3s ease;
      outline: none;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }
    .theme-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s ease;
    }
    .theme-btn:hover::before { left: 100%; }
    .theme-btn:hover {
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }
    .theme-btn.selected {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: rgba(255, 255, 255, 0.3);
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .custom-theme-fields {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    .color-input-group {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .color-input-group label {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--fg, #ffffff);
    }
    .color-input-wrapper {
      position: relative;
    }
    .custom-theme-fields input[type="color"] {
      width: 44px;
      height: 44px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      background: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .custom-theme-fields input[type="color"]:hover {
      border-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    .save-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      border: none;
      border-radius: 12px;
      padding: 14px 28px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
      width: 100%;
    }
    .save-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s ease;
    }
    .save-btn:hover::before { left: 100%; }
    .save-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    .save-btn:active { transform: translateY(0); }

    /* Clean input styles */
    .form-group {
      margin-bottom: 20px;
    }
    .form-group:last-child {
      margin-bottom: 0;
    }
    .form-label {
      display: block;
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--fg, #ffffff);
      margin-bottom: 8px;
    }
    .form-input, .form-select {
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.08);
      color: var(--fg, #ffffff);
      font-size: 0.95rem;
      transition: all 0.3s ease;
      outline: none;
    }
    .form-input:focus, .form-select:focus {
      border-color: #667eea;
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    .form-select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 12px center;
      background-repeat: no-repeat;
      background-size: 16px;
      padding-right: 48px;
    }
    
    /* Fixed dropdown options styling */
    .form-select option {
      color: var(--fg, #ffffff);
      background: var(--bg, #0f0f0f);
      padding: 8px 12px;
    }
    
    /* Alternative approach for better browser compatibility */
    body[data-theme="dark"] .form-select option {
      color: #ffffff;
      background: #2a2a2a;
    }
    
    body[data-theme="light"] .form-select option {
      color: #1a202c;
      background: #ffffff;
    }
    
    body[data-theme="purple"] .form-select option {
      color: #edf2f7;
      background: #2d1b3d;
    }

    /* Clean list styles */
    .clean-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 200px;
      overflow-y: auto;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .clean-list:empty {
      display: none;
    }
    .clean-list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.9rem;
      color: var(--fg, #ffffff);
      transition: background-color 0.2s ease;
    }
    .clean-list-item:last-child {
      border-bottom: none;
    }
    .clean-list-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    .clean-list-text {
      flex: 1;
      word-break: break-all;
    }
    .remove-btn {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: all 0.2s ease;
      margin-left: 12px;
      flex-shrink: 0;
    }
    .remove-btn:hover {
      color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
    }

    /* Clean add button */
    .add-row {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    .add-row .form-input {
      flex: 1;
      margin-bottom: 0;
    }
    .add-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
    }
    .add-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    .add-btn:active {
      transform: translateY(0);
    }

    /* Toggle label styling */
    .toggle-label {
      font-size: 1rem;
      font-weight: 500;
      color: var(--fg, #ffffff);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .settings-grid { grid-template-columns: 1fr; gap: 24px; }
      .container { padding: 24px 16px; }
      .section { padding: 24px; }
      h1 { font-size: 2rem; margin-bottom: 32px; }
      .theme-buttons { grid-template-columns: 1fr; }
      .add-row { flex-direction: column; }
      .add-row .form-input { margin-bottom: 12px; }
    }
    @media (max-width: 480px) {
      .section { padding: 20px; }
      h1 { font-size: 1.75rem; }
      .theme-btn { padding: 10px 14px; font-size: 0.9rem; }
      .setting-row { flex-direction: column; align-items: flex-start; gap: 12px; }
      .toggle-switch { align-self: flex-end; }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <h1>Settings</h1>
    <div class="settings-grid">
      <!-- Startup Restore -->
      <form class="section" id="restoreTabsSection" onsubmit="return false;">
        <h2 class="section-title">Startup Behavior</h2>
        <p class="section-desc">Configure how Fusion Tabs behaves when you start your browser.</p>
        <div class="setting-row">
          <div>
            <div style="font-size: 1.1rem; font-weight: 500; margin-bottom: 4px;">Restore Tabs on Startup</div>
            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">Re-opens your tabs from your last session</div>
          </div>
          <label class="toggle-switch">
            <input id="restoreTabsToggle" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <button class="save-btn" onclick="saveRestoreTabs()">Save Changes</button>
      </form>

      <!-- Appearance/Theme -->
      <form class="section" id="themeSection" onsubmit="return false;">
        <h2 class="section-title">Appearance</h2>
        <p class="section-desc">Customize the look and feel of your Fusion Tabs experience.</p>
        <div class="theme-buttons">
          <button type="button" class="theme-btn" id="theme-dark">🌙 Dark</button>
          <button type="button" class="theme-btn" id="theme-light">☀️ Light</button>
          <button type="button" class="theme-btn" id="theme-purple">💜 Purple</button>
          <button type="button" class="theme-btn" id="theme-custom">🎨 Custom</button>
        </div>
        <div id="customThemeFields" class="custom-theme-fields" style="display:none;">
          <div class="color-input-group">
            <label>Background Color</label>
            <div class="color-input-wrapper">
              <input type="color" id="ct-bg" value="#202124">
            </div>
          </div>
          <div class="color-input-group">
            <label>Text Color</label>
            <div class="color-input-wrapper">
              <input type="color" id="ct-fg" value="#e8eaed">
            </div>
          </div>
          <div class="color-input-group">
            <label>Panel Color</label>
            <div class="color-input-wrapper">
              <input type="color" id="ct-section-bg" value="#23242b">
            </div>
          </div>
        </div>
        <button class="save-btn" onclick="saveTheme()">Apply Theme</button>
      </form>

      <!-- Bare Proxy Settings -->
      <form class="section" id="bareSettingsSection" onsubmit="return false;">
        <h2 class="section-title">Bare Proxy</h2>
        <p class="section-desc">Configure custom bare proxy endpoints for enhanced privacy and access.</p>
        
        <div class="setting-row">
          <span class="toggle-label">Enable Bare Proxy</span>
          <label class="toggle-switch">
            <input id="bareSwitchToggle" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>

        <ul class="clean-list" id="bareUrlList"></ul>

        <div class="add-row">
          <input id="bareUrlInput" type="text" class="form-input" placeholder="https://bare.example.com">
          <button type="button" class="add-btn" onclick="addBareUrl()">Add</button>
        </div>

        <button class="save-btn" onclick="saveBareSettings()">Save Settings</button>
      </form>

      <!-- Search Engine Settings -->
      <form class="section" id="searchEngineSection" onsubmit="return false;">
        <h2 class="section-title">Search Engine</h2>
        <p class="section-desc">Choose your default search provider or add a custom search engine.</p>
        
        <div class="form-group">
          <label class="form-label" for="searchEngineSelect">Default Search Engine</label>
          <select id="searchEngineSelect" class="form-select"></select>
        </div>

        <div class="add-row">
          <input id="searchNameInput" type="text" class="form-input" placeholder="Engine Name">
          <input id="searchUrlInput" type="text" class="form-input" placeholder="Search URL (e.g. https://duckduckgo.com/?q=)">
        </div>
        
        <div class="form-group">
          <input id="searchLogoInput" type="text" class="form-input" placeholder="Logo URL (optional)">
        </div>

        <div style="display: flex; gap: 12px; margin-bottom: 20px;">
          <button type="button" class="add-btn" onclick="addSearchEngine()" style="flex: 1;">Add Custom Engine</button>
        </div>

        <button class="save-btn" onclick="saveSearchEngine()">Save Search Engine</button>
      </form>

    </div>
  </div>
  <script>
    // --- Restore Tabs ---
    function saveRestoreTabs() {
      const checked = document.getElementById('restoreTabsToggle').checked;
      localStorage.setItem('restoreTabs', checked ? '1' : '0');
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = '✓ Saved!';
      btn.style.background = 'linear-gradient(135deg, #00C851 0%, #007E33 100%)';
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      }, 1500);
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('restoreTabsToggle').checked = localStorage.getItem('restoreTabs') === '1';
      loadThemeUI();
      loadBareUI();
      loadSearchEngineUI();
    });

    // --- Theme Switcher ---
    const themes = {
      dark:   { bg: "#0f0f0f", fg: "#ffffff", section_bg: "rgba(255, 255, 255, 0.05)" },
      light:  { bg: "#f8fafc", fg: "#1a202c", section_bg: "rgba(255, 255, 255, 0.8)" },
      purple: { bg: "#1a0b2e", fg: "#edf2f7", section_bg: "rgba(123, 44, 191, 0.1)" }
    };
    
    function setThemeVars(theme) {
      document.body.style.setProperty("--bg", theme.bg);
      document.body.style.setProperty("--fg", theme.fg);
      document.body.style.setProperty("--section-bg", theme.section_bg);
    }
    
    function updateBodyTheme(themeName) {
      document.body.setAttribute('data-theme', themeName);
    }
    
    function highlightThemeBtn(id) {
      document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('selected'));
      document.getElementById(id).classList.add('selected');
    }
    
    function loadThemeUI() {
      let theme = localStorage.getItem('theme') || 'dark';
      let customTheme = JSON.parse(localStorage.getItem('customTheme') || '{}');
      if (theme === 'custom' && customTheme.bg && customTheme.fg && customTheme.section_bg) {
        setThemeVars(customTheme);
        updateBodyTheme('custom');
        highlightThemeBtn('theme-custom');
        document.getElementById('ct-bg').value = customTheme.bg;
        document.getElementById('ct-fg').value = customTheme.fg;
        document.getElementById('ct-section-bg').value = customTheme.section_bg;
        document.getElementById('customThemeFields').style.display = '';
      } else {
        setThemeVars(themes[theme] || themes.dark);
        updateBodyTheme(theme);
        highlightThemeBtn('theme-' + theme);
        document.getElementById('customThemeFields').style.display = 'none';
      }
    }
    
    document.getElementById('theme-dark').onclick = function() {
      localStorage.setItem('theme', 'dark');
      setThemeVars(themes.dark);
      updateBodyTheme('dark');
      highlightThemeBtn('theme-dark');
      document.getElementById('customThemeFields').style.display = 'none';
    };
    
    document.getElementById('theme-light').onclick = function() {
      localStorage.setItem('theme', 'light');
      setThemeVars(themes.light);
      updateBodyTheme('light');
      highlightThemeBtn('theme-light');
      document.getElementById('customThemeFields').style.display = 'none';
    };
    
    document.getElementById('theme-purple').onclick = function() {
      localStorage.setItem('theme', 'purple');
      setThemeVars(themes.purple);
      updateBodyTheme('purple');
      highlightThemeBtn('theme-purple');
      document.getElementById('customThemeFields').style.display = 'none';
    };
    
    document.getElementById('theme-custom').onclick = function() {
      localStorage.setItem('theme', 'custom');
      let custom = JSON.parse(localStorage.getItem('customTheme') || '{}');
      setThemeVars({
        bg: custom.bg || "#202124",
        fg: custom.fg || "#e8eaed",
        section_bg: custom.section_bg || "rgba(255, 255, 255, 0.05)"
      });
      updateBodyTheme('custom');
      highlightThemeBtn('theme-custom');
      document.getElementById('customThemeFields').style.display = '';
    };
    
    function saveTheme() {
      let theme = localStorage.getItem('theme') || 'dark';
      const btn = event.target;
      const originalText = btn.textContent;
      if (theme === 'custom') {
        let custom = {
          bg: document.getElementById('ct-bg').value,
          fg: document.getElementById('ct-fg').value,
          section_bg: document.getElementById('ct-section-bg').value
        };
        localStorage.setItem('customTheme', JSON.stringify(custom));
        setThemeVars(custom);
        updateBodyTheme('custom');
      } else {
        setThemeVars(themes[theme]);
        updateBodyTheme(theme);
      }
      btn.textContent = '✓ Applied!';
      btn.style.background = 'linear-gradient(135deg, #00C851 0%, #007E33 100%)';
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      }, 1500);
    }
    
    document.getElementById('ct-bg').addEventListener('input', function() {
      document.body.style.setProperty("--bg", this.value);
    });
    document.getElementById('ct-fg').addEventListener('input', function() {
      document.body.style.setProperty("--fg", this.value);
    });
    document.getElementById('ct-section-bg').addEventListener('input', function() {
      document.body.style.setProperty("--section-bg", this.value);
    });

    // --- Bare Proxy Settings ---
    function loadBareUI() {
      document.getElementById('bareSwitchToggle').checked = localStorage.getItem('bareEnabled') === '1';
      const bareList = JSON.parse(localStorage.getItem('bareUrls') || '[]');
      renderBareUrlList(bareList);
    }
    function renderBareUrlList(urls) {
      const ul = document.getElementById('bareUrlList');
      ul.innerHTML = '';
      urls.forEach((url, idx) => {
        const li = document.createElement('li');
        li.className = 'clean-list-item';
        
        const textSpan = document.createElement('span');
        textSpan.className = 'clean-list-text';
        textSpan.textContent = url;
        
        const btn = document.createElement('button');
        btn.className = 'remove-btn';
        btn.innerHTML = '✕';
        btn.title = 'Remove';
        btn.onclick = function() {
          const arr = JSON.parse(localStorage.getItem('bareUrls') || '[]');
          arr.splice(idx, 1);
          localStorage.setItem('bareUrls', JSON.stringify(arr));
          renderBareUrlList(arr);
        };
        
        li.appendChild(textSpan);
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }
    function addBareUrl() {
      const input = document.getElementById('bareUrlInput');
      let url = input.value.trim();
      if (!/^https?:\/\//i.test(url)) {
        alert("Please enter a valid URL starting with http:// or https://");
        return;
      }
      let arr = JSON.parse(localStorage.getItem('bareUrls') || '[]');
      if (arr.includes(url)) {
        alert('URL already added.');
        return;
      }
      arr.push(url);
      localStorage.setItem('bareUrls', JSON.stringify(arr));
      renderBareUrlList(arr);
      input.value = '';
    }
    function saveBareSettings() {
      localStorage.setItem('bareEnabled', document.getElementById('bareSwitchToggle').checked ? '1' : '0');
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = '✓
